!function(a,b){"function"==typeof define&&define.amd?(a.marked=require("./marked"),a.RevealMarkdown=b(a.marked)):"object"==typeof exports?module.exports=b(require("./marked")):a.RevealMarkdown=b(a.marked)}(this,function(a){function b(a){var b=a.querySelector("[data-template]")||a.querySelector("script"),c=(b||a).textContent;c=c.replace(new RegExp(q,"g"),"</script>");var d=c.match(/^\n?(\s*)/)[1].length,e=c.match(/^\n?(\t*)/)[1].length;return e>0?c=c.replace(new RegExp("\\n?\\t{"+e+"}","g"),"\n"):d>1&&(c=c.replace(new RegExp("\\n? {"+d+"}","g"),"\n")),c}function c(a){for(var b=a.attributes,c=[],d=0,e=b.length;e>d;d++){var f=b[d].name,g=b[d].value;/data\-(markdown|separator|vertical|notes)/gi.test(f)||(g?c.push(f+'="'+g+'"'):c.push(f))}return c.join(" ")}function d(a){return a=a||{},a.separator=a.separator||m,a.notesSeparator=a.notesSeparator||n,a.attributes=a.attributes||"",a}function e(b,c){c=d(c);var e=b.split(new RegExp(c.notesSeparator,"mgi"));return 2===e.length&&(b=e[0]+'<aside class="notes">'+a(e[1].trim())+"</aside>"),b=b.replace(/<\/script>/g,q),'<script type="text/template">'+b+"</script>"}function f(a,b){b=d(b);for(var c,f,g,h=new RegExp(b.separator+(b.verticalSeparator?"|"+b.verticalSeparator:""),"mg"),i=new RegExp(b.separator),j=0,k=!0,l=[];c=h.exec(a);)notes=null,f=i.test(c[0]),!f&&k&&l.push([]),g=a.substring(j,c.index),f&&k?l.push(g):l[l.length-1].push(g),j=h.lastIndex,k=f;(k?l:l[l.length-1]).push(a.substring(j));for(var m="",n=0,o=l.length;o>n;n++)l[n]instanceof Array?(m+="<section "+b.attributes+">",l[n].forEach(function(a){m+="<section data-markdown>"+e(a,b)+"</section>"}),m+="</section>"):m+="<section "+b.attributes+" data-markdown>"+e(l[n],b)+"</section>";return m}function g(){return new Promise(function(a){var d=[];[].slice.call(document.querySelectorAll("[data-markdown]")).forEach(function(a,g){a.getAttribute("data-markdown").length?d.push(h(a).then(function(b,d){a.outerHTML=f(b.responseText,{separator:a.getAttribute("data-separator"),verticalSeparator:a.getAttribute("data-separator-vertical"),notesSeparator:a.getAttribute("data-separator-notes"),attributes:c(a)})},function(b,c){a.outerHTML='<section data-state="alert">ERROR: The attempt to fetch '+c+" failed with HTTP status "+b.status+".Check your browser's JavaScript console for more details.<p>Remember that you need to serve the presentation HTML from a HTTP server.</p></section>"})):a.getAttribute("data-separator")||a.getAttribute("data-separator-vertical")||a.getAttribute("data-separator-notes")?a.outerHTML=f(b(a),{separator:a.getAttribute("data-separator"),verticalSeparator:a.getAttribute("data-separator-vertical"),notesSeparator:a.getAttribute("data-separator-notes"),attributes:c(a)}):a.innerHTML=e(b(a))}),Promise.all(d).then(a)})}function h(a){return new Promise(function(b,c){var d=new XMLHttpRequest,e=a.getAttribute("data-markdown");datacharset=a.getAttribute("data-charset"),null!=datacharset&&""!=datacharset&&d.overrideMimeType("text/html; charset="+datacharset),d.onreadystatechange=function(a,d){4===d.readyState&&(d.status>=200&&d.status<300||0===d.status?b(d,e):c(d,e))}.bind(this,a,d),d.open("GET",e,!0);try{d.send()}catch(f){alert("Failed to get the Markdown file "+e+". Make sure that the presentation and the file are served by a HTTP server and the file can be found there. "+f),b(d,e)}})}function i(a,b,c){var d=new RegExp(c,"mg"),e=new RegExp('([^"= ]+?)="([^"=]+?)"',"mg"),f=a.nodeValue;if(matches=d.exec(f)){var g=matches[1];for(f=f.substring(0,matches.index)+f.substring(d.lastIndex),a.nodeValue=f;matchesClass=e.exec(g);)b.setAttribute(matchesClass[1],matchesClass[2]);return!0}return!1}function k(a,b,c,d,e){if(null!=b&&void 0!=b.childNodes&&b.childNodes.length>0){previousParentElement=b;for(var f=0;f<b.childNodes.length;f++){if(childElement=b.childNodes[f],f>0)for(j=f-1;j>=0;){if(aPreviousChildElement=b.childNodes[j],"function"==typeof aPreviousChildElement.setAttribute&&"BR"!=aPreviousChildElement.tagName){previousParentElement=aPreviousChildElement;break}j-=1}parentSection=a,"section"==childElement.nodeName&&(parentSection=childElement,previousParentElement=childElement),("function"==typeof childElement.setAttribute||childElement.nodeType==Node.COMMENT_NODE)&&k(parentSection,childElement,previousParentElement,d,e)}}b.nodeType==Node.COMMENT_NODE&&0==i(b,c,d)&&i(b,a,e)}function l(){var c=document.querySelectorAll("[data-markdown]:not([data-markdown-parsed])");return[].slice.call(c).forEach(function(c){c.setAttribute("data-markdown-parsed",!0);var d=c.querySelector("aside.notes"),e=b(c);c.innerHTML=a(e),k(c,c,null,c.getAttribute("data-element-attributes")||c.parentNode.getAttribute("data-element-attributes")||o,c.getAttribute("data-attributes")||c.parentNode.getAttribute("data-attributes")||p),d&&c.appendChild(d)}),Promise.resolve()}var m="^\r?\n---\r?\n$",n="notes?:",o="\\.element\\s*?(.+?)$",p="\\.slide:\\s*?(\\S.+?)$",q="__SCRIPT_END__",r={init:function(b){if("undefined"==typeof a)throw"The reveal.js Markdown plugin requires marked to be loaded";"undefined"!=typeof hljs&&a.setOptions({highlight:function(a,b){return hljs.highlightAuto(a,[b]).value}});var c=Reveal.getConfig().markdown;return c&&a.setOptions(c),g().then(l)},processSlides:g,convertSlides:l,slidify:f};return Reveal.registerPlugin("markdown",r),r});